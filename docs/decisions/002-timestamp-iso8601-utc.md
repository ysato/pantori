# ADR-002: タイムスタンプのISO8601/UTC対応

## ステータス

採用済み

## 背景

パントリーシステムの設計において、タイムスタンプの管理方針を決定する必要があった：

- データベースでの時刻データ保存形式
- アプリケーションでの時刻出力形式
- 国際標準への準拠
- 将来の拡張性（国際化対応）
- システム間連携での一貫性

## 決定事項

### 1. データベース設計
- **型**: DATETIME型を採用（TIMESTAMP型から変更）
- **基準時刻**: UTC統一
- **精度**: 秒単位（ミリ秒は必要時に拡張）

### 2. Laravel設定
- **タイムゾーン**: `config/app.php` でタイムゾーン='UTC'
- **Carbon使用**: UTC基準での日時処理


### 4. 対象テーブル
全テーブルのタイムスタンプフィールドを統一

## 理由

### UTC採用の理由
- **データ整合性**: データベース内で統一基準による一貫性
- **タイムゾーン問題回避**: サマータイム変更の影響を受けない
- **国際化対応**: 将来的な海外展開に対応可能
- **システム連携**: 標準的な時刻形式による外部システム連携
- **開発・運用簡単さ**: ログ・バックアップ時刻の統一

### UTC採用の理由
- **データ整合性**: データベース内で統一基準による一貫性
- **タイムゾーン問題回避**: サマータイム変更の影響を受けない
- **国際化対応**: 将来的な海外展開に対応可能
- **開発・運用簡単さ**: ログ・バックアップ時刻の統一

### DATETIME型採用の理由
- **明確性**: UTC基準であることが設計上明確
- **精度制御**: 必要に応じてマイクロ秒精度に拡張可能
- **Laravel対応**: Eloquent ORMでの自然な扱い

## 選択肢と却下理由

### タイムゾーン付き時刻（却下）
- **複雑性**: 異なるタイムゾーン間の比較が複雑
- **ストレージコスト**: タイムゾーン情報分のデータ増
- **MVP不適**: 家庭用途での過度な複雑化

### TIMESTAMP型（却下）
- **2038年問題**: MySQL TIMESTAMPの制限
- **タイムゾーン依存**: データベース設定に依存する挙動

### Unix タイムスタンプ（却下）
- **可読性**: 人間が読めない形式
- **デバッグ困難**: ログ確認時の手間

## 結果

### 期待される効果
- **一貫性**: システム全体での時刻管理統一
- **拡張性**: 将来の国際化対応基盤
- **標準準拠**: 業界標準に沿った実装
- **運用性**: ログ・監視での時刻統一

### 実装上の注意点
- Laravel `config/app.php` でタイムゾーン='UTC'設定必須
- テスト時のUTC時刻での検証必須

## 影響範囲

### 開発への影響
- マイグレーションファイルでTIMESTAMP型指定
- Eloquentモデルでの日時処理（UTC基準）

### 運用への影響
- データベースサーバーのタイムゾーン設定確認
- ログファイルの時刻統一
- バックアップ時刻の統一

## 備考

- 標準的なUTC管理により将来拡張が容易
- 必要に応じて将来ミリ秒精度に拡張可能な設計を維持
