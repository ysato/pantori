# パントリーシステム アーキテクチャ設計

## システム概要

一般家庭向けのパントリー在庫管理システム。登録したアイテムの残数が閾値を下回っているものを一覧で確認でき、買い物時の効率化を実現する。

## アーキテクチャパターン

- **パターン**: Laravel MVC パターン
- **理由**: 
  - MVPでの迅速な開発に適している
  - Laravel標準の規約に沿った開発が可能
  - 単一ユーザー要件に対してオーバーエンジニアリングを避けられる

## コンポーネント構成

### フロントエンド
- **レンダリング**: サーバーサイドレンダリング（Blade テンプレート）
- **JavaScript**: 最小限のクライアントサイドJS（フォーム補完・UI改善）
- **スタイリング**: CSS フレームワーク使用予定（Bootstrap等）

### バックエンド
- **フレームワーク**: Laravel（PHP）
- **認証方式**: Laravel標準Web認証（セッションベース）
- **アーキテクチャ**: 2層構成（MVP段階）
  - **コントローラー層**: HTTP リクエスト処理・入力検証・基本ビジネスロジック
  - **モデル層**: データアクセス・データ整合性・ドメインルール

### データベース
- **RDBMS**: MySQL/PostgreSQL（数値精度要件対応）
- **ORM**: Eloquent ORM
- **マイグレーション**: Laravel標準マイグレーション機能

## 責務分離方針

### 入力検証
- **責務**: ユーザー入力の形式チェック・セキュリティ検証
- **実装場所**: FormRequest クラス
- **検証内容**: 数値範囲・権限チェック・CSRF保護

### ビジネスロジック（MVP段階）
- **責務**: パントリー管理・アイテム管理・在庫追跡の基本ルール
- **実装場所**: コントローラー・Eloquentモデル内
- **主要ロジック**: 
  - 補充必要判定（`current_quantity <= threshold_quantity`）
  - オーナー権限確認（`pantry.owner_id === auth.user.id`）
  - 基本的なCRUD操作
- **将来拡張**: 複雑化時にサービス層へリファクタリング

### データ整合性
- **責務**: データベースレベルでの整合性保証
- **実装場所**: Eloquent モデル・マイグレーション
- **保証内容**: 
  - リレーション整合性（CASCADE削除）
  - 数値制約（DECIMAL精度）
  - インデックス設計

## セキュリティ方針

### 認証・認可
- **認証**: Laravel標準認証システム
- **認可**: ポリシーベースのアクセス制御
- **セッション**: Laravel標準セッション管理

### データ保護
- **暗号化**: Laravel標準暗号化（パスワード等）
- **CSRF保護**: Laravel標準CSRF トークン
- **SQL インジェクション対策**: Eloquent ORM使用

## パフォーマンス方針

### レスポンス時間要件
- **アイテム一覧表示**: 3秒以内
- **残数不足一覧**: 2秒以内

### 最適化戦略
- **データベース**: インデックス最適化・クエリ最適化
- **キャッシュ**: 必要に応じてセッションキャッシュ活用
- **ページネーション**: 大量データ対応

## 拡張性考慮

### 将来的な機能拡張対応
- **複数人同時アクセス**: 認可システムの拡張ポイント設計
- **サービス層導入**: ビジネスロジック複雑化時の分離ポイント確保

## 制約事項

### 技術的制約
- **数値精度**: DECIMAL(9,2) での残数・閾値管理
- **アクセス制御**: パントリーオーナーのみアクセス可能
- **セッション管理**: ブラウザクローズ時の状態管理

### 非機能制約
- **可用性**: 一般家庭利用レベル
- **スケーラビリティ**: 単一ユーザーでの利用想定
- **メンテナンス性**: Laravel標準規約準拠
